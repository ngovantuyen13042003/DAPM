@model Tuple<List<TbDotLu>, List<TbDanhMuc>, List<TbMucDoThietHai> , List<TbDotCuuTro>, List<TbTaiKhoan>, List<TbHangHoa>>

@{
    ViewData["Title"] = "Phân bổ hàng cứu trợ";
    Layout = null;
}

<link rel="stylesheet" href="~/css/detailCuuTro.css">
<div class="container">
    <h1>PHÂN BỔ HÀNG CỨU TRỢ</h1>
    <div class="dropdowns">
        <div>
            <label for="dot-lu">Đợt lũ</label>
            <select id="dot-lu" style="width: 150px" onchange="redirectToFilter()" >
                @foreach (var item in Model.Item1)
                {
                    <option value="@item.IdDotLu" selected="@(item.IdDotLu == ViewBag.dl_filter)">@item.TenDotLu</option>
                }
            </select>
        </div>

        <div>
            <label for="dot-cuu-tro">Đợt cứu trợ</label>

            <select id="dot-cuu-tro" style="width: 150px" onchange="getSelectedHang()">
                @if (Model.Item4 != null)
                {
                    foreach (var item in Model.Item4)
                    {
                        <option value="@item.IdDotCuuTro">@item.TenDotCuuTro</option>
                    }
                }
            </select>
        </div>

     

        <div>
            <label for="muc-thiet-hai">Mức thiệt hại</label>
            <select id="muc-thiet-hai" style="width: 150px" onchange="redirectToFiltertk()" >
                @foreach (var item in Model.Item3)
                {
                    <option value="@item.IdMucDo" selected="@(item.IdMucDo == ViewBag.mth_filter)">@item.MucThietHai</option>
                }
            </select>
        </div>
    </div>

    <div class="table-container" style="margin-top: 15px">

        <table>
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Gia đình</th>
                    <th>Địa chỉ</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Item5 != null)
                {
                    int a = 0;
                    foreach (var item in Model.Item5)
                    {
                        a++;
                        <tr>
                            <td >@a</td>
                            <td >@(item.HoVaTen == "" ? item.TenDangNhap : item.HoVaTen)</td>
                            <td> @(item.DiaChi == "" ? "" : item.DiaChi) <td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

  



    <div class="distribution" style="margin-top: 15px; display: flex">
        <div>
            <label for="loai-hang-hoa">Loại hàng hóa</label>
            <select id="loai-hang-hoa" style="width: 150px" onchange="redirectToFilterdm()">
                @foreach (var item in Model.Item2)
                {
                    <option value="@item.IdDanhMuc" selected="@(item.IdDanhMuc == ViewBag.dm_filter)" >@item.TenDanhMuc</option>
                }
            </select>
        </div>
        <div>
            <label for="ten-hang">Tên hàng</label>
            <select id="ten-hang" style="width: 150px" onchange="getSelectedHang()">
                @if (Model.Item6 != null)
                {
                    foreach (var item in Model.Item6)
                    {
                        <option value="@item.IdHangHoa">@item.TenHangHoa</option>
                    }
                }
            </select>
        </div>

        

        <div>
            <label>Số lượng</label>
                <input style="width: 150px" type="number" placeholder="Nhập số lượng">
        </div>
    </div>

    <div class="buttons">
        <button style="background: #98E0FF" id="save">Lưu</button>
    <button style="background: #DD4242" @Url.Action("Index", "TbChiTietHangCuuTroes") id="close">Đóng</button>
    </div>

    <script>
        function redirectToFilter() {
            var selectedValue = document.getElementById("dot-lu").value;
            var mthFilter = document.getElementById("muc-thiet-hai").value;
            var dmFilter = document.getElementById("loai-hang-hoa").value;

            var url = "/TbChiTietHangCuuTroes/Create?dl_filter=" + encodeURIComponent(selectedValue) + "&mth_filter=" + encodeURIComponent(mthFilter) + "&dm_filter=" + encodeURIComponent(dmFilter);

            window.location.href = url;
        }
    </script>

    <script>
        function redirectToFiltertk() {
            var selectedValue = document.getElementById("muc-thiet-hai").value;
            var dlFilter = document.getElementById("dot-lu").value;
            var dmFilter = document.getElementById("loai-hang-hoa").value;

            var url = "/TbChiTietHangCuuTroes/Create?mth_filter=" + encodeURIComponent(selectedValue) + "&dl_filter=" + encodeURIComponent(dlFilter) + "&dm_filter=" + encodeURIComponent(dmFilter);

            window.location.href = url;
        }
    </script>

    <script>
        function redirectToFilterdm() {
            var selectedValue = document.getElementById("loai-hang-hoa").value;
            var dlFilter = document.getElementById("dot-lu").value;
            var mthFilter = document.getElementById("muc-thiet-hai").value;

            var url = "/TbChiTietHangCuuTroes/Create?dm_filter=" + encodeURIComponent(selectedValue) + "&dl_filter=" + encodeURIComponent(dlFilter) + "&mth_filter=" + encodeURIComponent(mthFilter);

            window.location.href = url;
        }
    </script>

    <script>
        // Function to set selected value for dropdown
        function setSelectedValue(selectElementId, valueToSet) {
            var selectElement = document.getElementById(selectElementId);
            for (var i = 0; i < selectElement.options.length; i++) {
                if (selectElement.options[i].value == valueToSet) {
                    selectElement.options[i].selected = true;
                    break;
                }
            }
        }

        // Call the function to set selected values for each dropdown
        window.onload = function () {
            setSelectedValue("dot-lu", "@ViewBag.dl_filter");
            setSelectedValue("dot-cuu-tro", "@ViewBag.dl");
            setSelectedValue("muc-thiet-hai", "@ViewBag.mth_filter");
            setSelectedValue("loai-hang-hoa", "@ViewBag.dm_filter");
            setSelectedValue("ten-hang", "@ViewBag.dm");
        };
    </script>

    <script>
        function getSelectedHang() {
            var selectedHangId = document.getElementById("ten-hang").value;
            redirectToFilterWithHangId(selectedHangId);
        }

        function redirectToFilterWithHangId(hangId) {
            var selectedDotLuId = document.getElementById("dot-lu").value;
            var selectedDotCuuTroId = document.getElementById("dot-cuu-tro").value;
            var selectedMucThietHaiId = document.getElementById("muc-thiet-hai").value;
            var selectedDanhMucId = document.getElementById("loai-hang-hoa").value;

            var url = "/TbChiTietHangCuuTroes/Create?dl_filter=" + encodeURIComponent(selectedDotLuId) + "&mth_filter=" + encodeURIComponent(selectedMucThietHaiId) + "&dm_filter=" + encodeURIComponent(selectedDanhMucId) + "&dmf=" + encodeURIComponent(selectedDanhMucId) + "&mthf=" + encodeURIComponent(selectedMucThietHaiId) + "&dm=" + encodeURIComponent(hangId);

            window.location.href = url;
        }
    </script>




 

</div>
 


